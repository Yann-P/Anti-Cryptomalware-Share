import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from xcs_notifier import XCSNotifier, XCSNotifierException

class XCSMailNotifier(XCSNotifier):

    def __init__(self, config):
        self._hostname = config.getval('EMAIL_HOSTNAME')
        self._port = config.getval('EMAIL_PORT')
        self._mail_from = config.getval('EMAIL_FROM')

    def _send_mail(self, mail_to, subject, message):

        print ("sending mail to %s [subject] %s [message] %s" % (mail_to, subject, message))
        return

        try:
            msg = MIMEMultipart()
            msg['From'] = self._mail_from
            msg['To'] = mail_to
            msg['Subject'] = subject

            msg.attach(MIMEText(message, 'plain'))

            server = smtplib.SMTP(self._hostname, self._port)
            #server.starttls()
            #server.login(self._mail_from, "YOUR PASSWORD")
            text = msg.as_string()
            server.sendmail(self._mail_from, mail_to, text)
            server.quit()

        except smtplib.SMTPException as e:
            raise XCSMailNotifierException("SMTPException " + str(e))


class XCSMailNotifierException(XCSNotifierException):
    pass