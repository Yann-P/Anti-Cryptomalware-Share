import os
import sys
import hashlib
import subprocess

def git_status_hash(path):
	return hashlib.sha224(git_status(path)).hexdigest()

def git_status(path):
	os.chdir(path)
	return subprocess.check_output('git status --porcelain', shell=True)

def nb_files_changed(path):
	os.chdir(path)
	return int(subprocess.check_output('git status --porcelain | wc -l', shell=True))

def rollback(path):
	full_path = os.path.join(os.path.basename(sys.argv[0]), path)
	print "This command will ERASE all changes since the last commit in the repository specified in the conf file."
	print "Are you sure you want to erase all changes in " + full_path + "?"
	if raw_input().lower() in set(['yes', 'y']):
		os.chdir(path)
		os.system('git reset HEAD --hard')
		os.system('git clean -fd')
	else:
		print "Abort."